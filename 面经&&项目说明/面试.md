# 可能的问题

## 1 自我介绍

面试官您好，我叫谢家衍，就读于中国地质大学计算机专业，课程主修有操作系统，计算机网络，数据结构，数据库原理等基础课程。

此外在Github找了两个项目来做，一个是基于linux0.11进行组件开发，目的是了解linux系统的基础机制，如系统调用、进程切换、内存管理等方面的知识。另一个项目是基于开源数据库Bustub的组件开发，旨在加强C++编程能力和了解C++11新特性。最后一个项目是学院组织的应用开发实习，包括编写需求分析，概要设计，详细设计等各类文档，以及对系统功能的编码实现，目的是了解软件开发的流程，加强团队协作能力与沟通能力。

毕业后我期望从事C++后端开发相关的工作。我的自我介绍完毕。

## 2 介绍一下项目

### **Linux0.11**

首先是实现两个系统调用，了解系统调用的过程：先调用用户态的库函数，在库函数中将系统调用进行syscall宏展开，触发中断进入内核，通过系统调用函数地址表跳转到，调用相应的系统调用、system_call函数执行功能。
流程：先在内核中添加系统调用声明和实现系统调用对应的内核函数，然后在用户态函数中对系统调用进行宏展开，宏展开之后加上内核中有系统调用的声明，就可以从用户态进入到内核态。

基于内核栈的进程切换：修改switch_to、修改fork。
重写switch_to，用汇编切换PCB、切换内核栈、切换LDT等
修改fork是为了，tss存放寄存器的值是存放在TSS数据结构里的，现在要将这些值按顺序压入内核栈中。在PCB中加入栈顶的位置。

信号量的实现，目的是了解进程同步和互斥的概念：首先是根据第一步实现系统调用的流程实现4个系统调用，sem_open、sem_wait--P操作--等待信号量、sem_post--V操作--唤醒进程、sem_unlink。
然后声明sem_t类型结构体变量，里面有name，value初值，task_struct阻塞在这个信号量上的指针。读写文件用fprint，非print和printk
生产者消费者进程的核心代码是在读取和写入文件的代码前后加上对信号量的PV操作，信号量对应的系统调用的实现是在在对信号量的value更改的时候加上cli、sti硬件开关中断指令。

地址映射与共享：在进程的PCB里维护了进程的标识信息，如ldt值、gdt值等，然后在进程获得一块内存，用malloc获得，这样就能得到这块内存的起始地址。但这个地址是逻辑地址，所以还需要从PCB中获取段基址信息，才能得到虚拟地址，然后经过分段转换得到线性地址，经过分页转换得到物理地址。生产者消费者在PV操作中间加上申请和释放共享内存的代码。申请和释放共享内存的操作封装为两个函数，还有一个从逻辑地址转换掉到物理地址的函数。
通过shmget、shmat、shmdt系统调用的组合来申请共享内存，get用于创建或获取共享内存段的标识符，通过get_free_page获取物理页，at用于将共享内存段映射到调用进程的地址空间，就可以通过指针来访问共享内存中的数据，dt用于解除共享内存段与调用进程的映射关系。

### **BusTub**

首先是实现一个缓冲池管理器，充当数据库上层设施与物理磁盘的中间组件，负责在内存帧和磁盘页面之间来回移动物理页面内容，包括对内存帧的创建、获取、驱逐、取消引用，和对页面内容的刷新。使用可扩展哈希表存储内存帧frame_id和物理页面的page_id的映射关系。在内存槽位满的时候，使用LRU-K算法进行内存帧的置换。

可扩展哈希使用vector向量来做目录，用无序桶（类）来存储帧ID和页面ID组成的键值对。vector向量存储指向桶的指针，无序桶用list来存储键值对。

LRU-K算法用list来实现缓存队列和历史访问队列，用一个结构体来存储可驱逐属性、访问引用计数、list迭代器指向的在队列中的位置信息。

实现B+树的目的是为了页面的快速查找，作为数据库系统的索引，实现页面的插入、删除、查找。

C++11新特性有智能指针如unique_ptr、shared_ptr、右值引用、移动语义、对互斥量mutex进行包装的lock_guard类型，目的是使用RAII机制，防止因出现异常导致没有解锁。

难点：这个项目相关的知识点和用到的C++11新特性比较多，这些之前很少遇到过，每遇到一个都需要暂停编码，先去学习这些新特性。
然后是这个项目写的代码需要在多线程环境跑通，要给功能代码上锁解锁，所以经常死锁，排查的时候比较头疼。

### **综合实习**

综合实习的内容是15人为一组，以C++/Qt为框架开发数字矿山系统，目的是了解软件开发的全流程。我担任的是C++开发组组长，工作内容是：与前端开发者组长、unity3D开发者组长一起配合项目经理，从甲方获取需求，进行需求分析，再给出概要设计说明文档、详细设计说明文档，完成编码后给出系统功能说明文档。对内和3位组员分工合作，完成各个文档的编写和功能代码的实现。

编码：根据甲方给出的地层钻孔线数据，将分层的钻孔线建模成二维矿面，再将二维矿面格网化成三维矿体，最后对三维矿体进行块体建模。矿面用list存储顶点信息，矿体使用vector存储矿面信息，块体建模会生成一颗四叉树，树节点存放在矿体内部的块体的中心点信息。

难点与重点：与团队成员的沟通交流，要根据每个人的编码能力合理分工，分工后要确保每个成员的工作内容是否跟上整体进度，因为组长不仅要负责组内的工作内容与进度，还要向上汇报结果给项目经理，来保证各个开发小组负责的模块最后能同时交付给项目经理进行集成。

## 3 最有成就感的一件事

写linux0.11这个项目的时候，因为课本上的知识偏理论，然后自己写代码经历过的或者遇到的问题大多是怎么用，而不知道用的这个是什么，以及为什么这样用。就像操作系统，上课内容是介绍理论知识，上机是写简化后的进程调度算法，用一些自定义的数据结构去模拟进程，模拟进程切换，即使写完了也是懵懵懂懂的，进程到底是什么？进程放在内存中的哪里？操作系统怎样去找到一个进程？看了一些linux0.11的源码之后，一个task_struct结构体实例，存放进程的标识信息、状态信息，同时，进程对应的程序文件的内容也不是以文件为单位放到内存里，然后记住这段内存的起始位置。而是拆分成代码段，数据段，堆栈段。然后段的概念是虚拟出来的，不是以段为单位把内容放到内存里，而是把段和物理内存都分成页，以页面为单位把进程内容存放到物理内存里。

就是之前学的一些理论的，抽象的概念，真正的看到它们实现的源代码之后，那种豁然开朗的感觉，看到那些偏底层的内容，就像是看到事物的本质，豁然开朗，是最有成就感的。

## 4 在项目中遇到的技术挑战，如何解决？

之前正在写项目的过程中，遇到的技术挑战有，像写linux0.11的时候，这一节系统调用，下一节进程，下一节分段、分页，每学完一个概念都是模模糊糊的，一直坚持到了解了足够多的内容，对整个操作系统有了一个简易的框架认识之后，才知道之前学的每一节内容在整个框架中充当怎样的一个角色，或者是在怎个流程中负责哪个步骤。

然后写BusTub的时候，遇到智能指针，不了解，学完了解之后，又遇到右值引用，不了解，学完了解之后，又遇到互斥量锁包装器，不了解，学完了解之后，又遇到新的不了解的。

其实我觉得，在项目中遇到技术挑战算不上，因为我写的项目，跟企业开发写的软件相比来说就是小玩具，因为我写的项目不是说，设计一个全新的组件，而是根据要求，实现一个组件，这个组件的实现需要这些知识，我去学完这些知识，然后实现它。就是没有太多原创性的内容，而是对已学的知识或者新学的知识的一个整合运用。所以技术挑战算不上，更多的是学习能力与学习态度上的挑战。

## 5 提升、成长
